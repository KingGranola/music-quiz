<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>éŸ³æ¥½ã‚¸ãƒ£ãƒ³ãƒ«çŸ¥è­˜è¨ºæ–­</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:title" content="éŸ³æ¥½ã‚¸ãƒ£ãƒ³ãƒ«çŸ¥è­˜è¨ºæ–­" />
  <meta property="og:description" content="30å•ã§ã‚ãªãŸã®éŸ³æ¥½ã‚¸ãƒ£ãƒ³ãƒ«çŸ¥è­˜ã‚’åˆ†æï¼ã©ã®ã‚¸ãƒ£ãƒ³ãƒ«ã«è©³ã—ã„ï¼Ÿ" />
  <meta property="og:image" content="https://yourname.github.io/music-quiz/img/og-image.png" />
  <meta property="og:url" content="https://yourname.github.io/music-quiz/" />
  <meta name="twitter:card" content="summary_large_image" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="css/style.css">
</head>

<body>

  <div id="container">
    <h1>éŸ³æ¥½ã‚¸ãƒ£ãƒ³ãƒ«çŸ¥è­˜è¨ºæ–­</h1>
    <div id="progress">
      <div id="progress-bar"></div>
      <span id="progress-text">1 / 30å•</span>
    </div>
    <div id="genre" class="genre-label"></div>
    <div id="question">èª­ã¿è¾¼ã¿ä¸­...</div>
    <div id="buttons">
      <button class="btn-level-3" onclick="answer(3)">5æ›²ä»¥ä¸ŠçŸ¥ã£ã¦ã„ã‚‹</button>
      <button class="btn-level-2" onclick="answer(2)">1æ›²ãã‚‰ã„ã¯çŸ¥ã£ã¦ã„ã‚‹</button>
      <button class="btn-level-1" onclick="answer(1)">ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆåã¯çŸ¥ã£ã¦ã„ã‚‹</button>
      <button class="btn-level-0" onclick="answer(0)">åå‰ã‚‚çŸ¥ã‚‰ãªã„</button>
    </div>

    <canvas id="chart" style="display: none;"></canvas>
    <div id="result" style="display: none;"></div>

    <div id="share" style="display: none; margin-top: 30px;">
      <a id="twitter-share-button" class="share-btn twitter" target="_blank">Twitterã§ã‚·ã‚§ã‚¢</a>
      <a id="line-share-button" class="share-btn line" target="_blank">LINEã§ã‚·ã‚§ã‚¢</a>
    </div>

  </div>
  <script src="js/artistData.js"></script>
  <script>
    let current = 0;
    const scores = {};
    const totalQuestions = 30; // å•é¡Œæ•°ã‚’30å•ã«å¤‰æ›´

    const questions = Object.keys(artistData)
      .map(genre => artistData[genre].sort(() => 0.5 - Math.random()).slice(0, 3)) // å„ã‚¸ãƒ£ãƒ³ãƒ«ã‹ã‚‰3å•ãšã¤
      .flat()
      .sort(() => 0.5 - Math.random())
      .slice(0, totalQuestions); // å…¨ä½“ã§30å•ã«ãªã‚‹ã‚ˆã†ã«èª¿æ•´

    function updateProgress() {
      const progressText = document.getElementById("progress-text");
      const progressBar = document.getElementById("progress-bar");
      const progress = ((current + 1) / totalQuestions) * 100;
      progressBar.style.width = `${progress}%`;
      progressText.innerText = `${current + 1} / ${totalQuestions}å•`;
    }

    function showQuestion() {
      if (current >= totalQuestions) return showResult();
      const q = questions[current];
      document.getElementById("genre").innerText = `ã‚¸ãƒ£ãƒ³ãƒ«ï¼š${q.genre}`;
      document.getElementById("question").innerText = `${q.artist_ja || q.artist_en}ï¼ˆ${q.artist_en}ï¼‰ã‚’ã©ã‚Œãã‚‰ã„çŸ¥ã£ã¦ã‚‹ï¼Ÿ`; // æ—¥æœ¬èªåãŒãªã„å ´åˆã«è‹±èªåã‚’è¡¨ç¤º
      updateProgress();
    }

    function answer(point) {
      const q = questions[current];
      if (!scores[q.genre]) scores[q.genre] = {
        score: 0,
        max: 0
      };
      scores[q.genre].score += point;
      scores[q.genre].max += 3;
      current++;
      showQuestion();
    }

    function showResult() {
      document.getElementById("question").style.display = "none";
      document.getElementById("buttons").style.display = "none";
      document.getElementById("progress").style.display = "none";
      document.getElementById("genre").style.display = "none";
      const labels = Object.keys(scores);
      const data = labels.map(g => Math.round((scores[g].score / scores[g].max) * 100));

      const ctx = document.getElementById("chart").getContext("2d");
      document.getElementById("chart").style.display = "block";

      new Chart(ctx, {
        type: 'radar',
        data: {
          labels,
          datasets: [{
            label: 'çŸ¥è­˜åº¦ï¼ˆ%ï¼‰',
            data,
            fill: true,
            backgroundColor: 'rgba(54, 162, 235, 0.2)',
            borderColor: 'rgba(54, 162, 235, 1)',
            pointBackgroundColor: 'rgba(54, 162, 235, 1)'
          }]
        },
        options: {
          responsive: true,
          scales: {
            r: {
              suggestedMin: 0,
              suggestedMax: 100
            }
          }
        }
      });

      const result = document.getElementById("result");
      let resultText = `<h2>è¨ºæ–­å®Œäº†ï¼</h2><p>ã‚¸ãƒ£ãƒ³ãƒ«ã”ã¨ã®çŸ¥è­˜åº¦ã‚’ã”ç¢ºèªãã ã•ã„ ğŸ§</p>`;

      // å¼·ã„ã‚¸ãƒ£ãƒ³ãƒ«ã€å¼±ã„ã‚¸ãƒ£ãƒ³ãƒ«ã‚’ç‰¹å®š
      const sortedGenres = labels.map((label, index) => ({
        genre: label,
        percentage: data[index]
      })).sort((a, b) => b.percentage - a.percentage);

      const topGenre = sortedGenres[0].genre;
      const worstGenre = sortedGenres[sortedGenres.length - 1].genre;

      resultText += `<p>ã‚ãªãŸã®å¾—æ„ãªã‚¸ãƒ£ãƒ³ãƒ«ã¯ã€Œ${topGenre}ã€ã§ã™ï¼</p>`;
      resultText += `<p>ã‚‚ã£ã¨çŸ¥ã‚ŠãŸã„ã‚¸ãƒ£ãƒ³ãƒ«ã¯ã€Œ${worstGenre}ã€ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚</p>`;

      // ãŠã™ã™ã‚ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆã‚’æç¤º (ä¸Šä½3ã‚¸ãƒ£ãƒ³ãƒ«ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«1ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆãšã¤æç¤º)
      resultText += `<p>ã‚ãªãŸã¸ã®ãŠã™ã™ã‚ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆã¯ã“ã¡ã‚‰ï¼</p><ul>`;
      for (let i = 0; i < Math.min(3, sortedGenres.length); i++) {
        const genre = sortedGenres[i].genre;
        const randomIndex = Math.floor(Math.random() * artistData[genre].length);
        const recommendedArtist = artistData[genre][randomIndex].artist_ja || artistData[genre][randomIndex].artist_en;
        resultText += `<li>${genre}: ${recommendedArtist}</li>`;
      }
      resultText += `</ul>`;

      result.innerHTML = resultText;
      result.style.display = "block";

      // SNSã‚·ã‚§ã‚¢ãƒœã‚¿ãƒ³
      const shareText = `ğŸµéŸ³æ¥½ã‚¸ãƒ£ãƒ³ãƒ«è¨ºæ–­ã®çµæœğŸµ\nç§ã¯ã€Œ${topGenre}ã€ã«è©³ã—ã„ã‚¿ã‚¤ãƒ—ã§ã—ãŸï¼`;
      const url = encodeURIComponent(window.location.href);
      document.getElementById("twitter-share-button").href =
        `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${url}`;
      document.getElementById("line-share-button").href =
        `https://social-plugins.line.me/lineit/share?url=${url}`;
      document.getElementById("share").style.display = "block";
    }

    showQuestion();
  </script>
</body>

</html>
