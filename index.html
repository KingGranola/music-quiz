<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>éŸ³æ¥½ã‚¸ãƒ£ãƒ³ãƒ«çŸ¥è­˜è¨ºæ–­</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:title" content="éŸ³æ¥½ã‚¸ãƒ£ãƒ³ãƒ«çŸ¥è­˜è¨ºæ–­" />
  <meta property="og:description" content="50å•ã§ã‚ãªãŸã®éŸ³æ¥½ã‚¸ãƒ£ãƒ³ãƒ«çŸ¥è­˜ã‚’åˆ†æï¼ã©ã®ã‚¸ãƒ£ãƒ³ãƒ«ã«è©³ã—ã„ï¼Ÿ" />
  <meta property="og:image" content="https://yourname.github.io/music-quiz/img/og-image.png" />
  <meta property="og:url" content="https://yourname.github.io/music-quiz/" />
  <meta name="twitter:card" content="summary_large_image" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="css/style.css">
</head>

<body>

  <div id="container">
    <h1>éŸ³æ¥½ã‚¸ãƒ£ãƒ³ãƒ«çŸ¥è­˜è¨ºæ–­</h1>
    <div id="progress">1 / 50å•</div>
    <div id="genre" class="genre-label"></div>
    <div id="question">èª­ã¿è¾¼ã¿ä¸­...</div>
    <div id="buttons">
      <button class="btn-level-3" onclick="answer(3)">5æ›²ä»¥ä¸ŠçŸ¥ã£ã¦ã„ã‚‹</button>
      <button class="btn-level-2" onclick="answer(2)">1æ›²ãã‚‰ã„ã¯çŸ¥ã£ã¦ã„ã‚‹</button>
      <button class="btn-level-1" onclick="answer(1)">ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆåã¯çŸ¥ã£ã¦ã„ã‚‹</button>
      <button class="btn-level-0" onclick="answer(0)">åå‰ã‚‚çŸ¥ã‚‰ãªã„</button>
    </div>

    <canvas id="chart" style="display: none;"></canvas>
    <div id="result" style="display: none;"></div>

    <div id="share" style="display: none; margin-top: 30px;">
      <a id="twitter-share-button" class="share-btn twitter" target="_blank">Twitterã§ã‚·ã‚§ã‚¢</a>
      <a id="line-share-button" class="share-btn line" target="_blank">LINEã§ã‚·ã‚§ã‚¢</a>
    </div>

  </div>
  <div id="version">ver 0.1 (build 1)</div>
  <script src="js/artistData.js"></script>
  <script>
    let current = 0;
    const scores = {};
    const totalQuestions = 50;

    const questions = Object.keys(artistData)
      .map(genre => artistData[genre].sort(() => 0.5 - Math.random()).slice(0, 5))
      .flat()
      .sort(() => 0.5 - Math.random());

    function updateProgress() {
      document.getElementById("progress").innerText = `${current + 1} / ${totalQuestions}å•`;
    }

    function showQuestion() {
      if (current >= totalQuestions) return showResult();
      const q = questions[current];
      document.getElementById("genre").innerText = `ã‚¸ãƒ£ãƒ³ãƒ«ï¼š${q.genre}`;
      document.getElementById("question").innerText = `${q.artist_ja}ï¼ˆ${q.artist_en}ï¼‰ã‚’ã©ã‚Œãã‚‰ã„çŸ¥ã£ã¦ã‚‹ï¼Ÿ`;
      updateProgress();
    }

    function answer(point) {
      const q = questions[current];
      if (!scores[q.genre]) scores[q.genre] = {
        score: 0,
        max: 0
      };
      scores[q.genre].score += point;
      scores[q.genre].max += 3;
      current++;
      showQuestion();
    }

    function showResult() {
      document.getElementById("question").style.display = "none";
      document.getElementById("buttons").style.display = "none";
      document.getElementById("progress").style.display = "none";
      document.getElementById("genre").style.display = "none"; // â† â† â† â˜…ã“ã‚Œã‚’è¿½åŠ ï¼
      const labels = Object.keys(scores);
      const data = labels.map(g => Math.round((scores[g].score / scores[g].max) * 100));

      const ctx = document.getElementById("chart").getContext("2d");
      document.getElementById("chart").style.display = "block";

      new Chart(ctx, {
        type: 'radar',
        data: {
          labels,
          datasets: [{
            label: 'çŸ¥è­˜åº¦ï¼ˆ%ï¼‰',
            data,
            fill: true,
            backgroundColor: 'rgba(54, 162, 235, 0.2)',
            borderColor: 'rgba(54, 162, 235, 1)',
            pointBackgroundColor: 'rgba(54, 162, 235, 1)'
          }]
        },
        options: {
          responsive: true,
          scales: {
            r: {
              suggestedMin: 0,
              suggestedMax: 100
            }
          }
        }
      });

      const result = document.getElementById("result");
      result.innerHTML = `<h2>è¨ºæ–­å®Œäº†ï¼</h2><p>ã‚¸ãƒ£ãƒ³ãƒ«ã”ã¨ã®çŸ¥è­˜åº¦ã‚’ã”ç¢ºèªãã ã•ã„ ğŸ§</p>`;
      result.style.display = "block";

      // SNSã‚·ã‚§ã‚¢ãƒœã‚¿ãƒ³
      const topGenre = labels[data.indexOf(Math.max(...data))];
      const shareText = `ğŸµéŸ³æ¥½ã‚¸ãƒ£ãƒ³ãƒ«è¨ºæ–­ã®çµæœğŸµ\nç§ã¯ã€Œ${topGenre}ã€ã«è©³ã—ã„ã‚¿ã‚¤ãƒ—ã§ã—ãŸï¼`;
      const url = encodeURIComponent(window.location.href);
      document.getElementById("twitter-share-button").href =
        `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${url}`;
      document.getElementById("line-share-button").href =
        `https://social-plugins.line.me/lineit/share?url=${url}`;
      document.getElementById("share").style.display = "block";
    }

    showQuestion();
  </script>
</body>

</html>
